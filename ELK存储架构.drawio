<mxfile host="app.diagrams.net" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/126.0.0.0 Safari/537.36" version="24.7.4">
  <diagram name="第 1 页" id="029q1-VEwSOVPz0OB3la">
    <mxGraphModel dx="2501" dy="1239" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="827" pageHeight="1169" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-22" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-360" y="160" width="1030" height="590" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-23" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-313" y="220" width="220" height="410" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-24" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="45" y="220" width="220" height="410" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-25" value="" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="404" y="220" width="220" height="410" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-27" value="&lt;b&gt;&lt;font style=&quot;font-size: 20px;&quot;&gt;ELK01&lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-234.5" y="260" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-28" value="&lt;b&gt;&lt;font style=&quot;font-size: 20px;&quot;&gt;ELK02&lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="125" y="260" width="60" height="30" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-29" value="&lt;b&gt;&lt;font style=&quot;font-size: 20px;&quot;&gt;ELK03&lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="490" y="255" width="60" height="40" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-54" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;curved=1;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-30" target="WC-gbT3LFDN5c_wE5Nhx-32">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-30" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;9300/tcp&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-254.5" y="200" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-57" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;curved=1;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-32" target="WC-gbT3LFDN5c_wE5Nhx-33">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-32" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;9300/tcp&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="105" y="200" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-55" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;curved=1;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-33" target="WC-gbT3LFDN5c_wE5Nhx-32">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-33" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;9300/tcp&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="470" y="200" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-37" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;9200/tcp&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-253" y="610" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-43" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeColor=default;curved=1;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-38" target="WC-gbT3LFDN5c_wE5Nhx-40">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-38" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;9200/tcp&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="105" y="610" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-40" value="&lt;b&gt;&lt;font style=&quot;font-size: 20px;&quot;&gt;Kibana&lt;/font&gt;&lt;/b&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-254.5" y="710" width="819" height="70" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-44" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;curved=1;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-39">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="470" y="710" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-45" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.12;entryY=-0.014;entryDx=0;entryDy=0;entryPerimeter=0;curved=1;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-37" target="WC-gbT3LFDN5c_wE5Nhx-40">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-48" value="" style="image;aspect=fixed;html=1;points=[];align=center;fontSize=12;image=img/lib/azure2/identity/Groups.svg;" vertex="1" parent="1">
          <mxGeometry x="524.28" y="928" width="145.72" height="120" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-56" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.445;entryY=0.025;entryDx=0;entryDy=0;entryPerimeter=0;curved=1;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-32" target="WC-gbT3LFDN5c_wE5Nhx-30">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-58" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;ELK存储架构&lt;/h1&gt;&lt;div&gt;&lt;font style=&quot;font-size: 18px;&quot;&gt;3分片2副本&lt;/font&gt;&lt;/div&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-360" y="80" width="160" height="70" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-59" value="&lt;div&gt;&lt;span style=&quot;font-family: &amp;quot;Roboto Mono&amp;quot;, Consolas, Menlo, Courier, monospace; text-align: start; white-space-collapse: preserve; background-color: rgb(255, 255, 255);&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="-360" y="808" width="620" height="240" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-60" value="&lt;h1 style=&quot;text-align: left; margin-top: 0px;&quot;&gt;分布式数据存储算法&lt;/h1&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-360" y="820" width="254.5" height="50" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-64" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.787;entryY=1;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-48" target="WC-gbT3LFDN5c_wE5Nhx-40">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="597" y="830" />
              <mxPoint x="390" y="830" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-66" value="分片0" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="-266.5" y="310" width="124" height="30" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-67" value="分片1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="105" y="310" width="124" height="30" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-68" value="分片2" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="464" y="310" width="124" height="30" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-80" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;curved=1;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-70" target="WC-gbT3LFDN5c_wE5Nhx-68">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="150" y="700" />
              <mxPoint x="330" y="700" />
              <mxPoint x="330" y="325" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-70" value="_id=&lt;span style=&quot;white-space-collapse: preserve; font-family: &amp;quot;Roboto Mono&amp;quot;, Consolas, Menlo, Courier, monospace; text-align: start; background-color: rgb(255, 255, 255);&quot;&gt;PADm6JAB1LVY62_tSbNI&lt;/span&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;hash(_id) ---&amp;gt; number % 主分片数量&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;div&gt;hash(_id) % 3 = 2&lt;/div&gt;" style="rounded=0;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="45" y="858" width="205" height="140" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-72" value="&lt;h1 style=&quot;margin-top: 0px;&quot;&gt;&lt;span style=&quot;font-size: 12px; font-weight: 400;&quot;&gt;在被存放的数据中都会有一个_id字段，这个字段使用来计算本条数据存储位置的，具体算法是通过哈希计算_id的摘要，会拿到一个很大的数，再去使用分片的数量对这个数进行取余，结果就是存储的位置。参考上面3分片1副本的架构图，右侧为参考例子。&lt;/span&gt;&lt;/h1&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="-340" y="868" width="380" height="120" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-39" value="&lt;font style=&quot;font-size: 14px;&quot;&gt;9200/tcp&lt;/font&gt;" style="rounded=1;whiteSpace=wrap;html=1;" vertex="1" parent="1">
          <mxGeometry x="464" y="610" width="100" height="40" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-97" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0;entryY=0.5;entryDx=0;entryDy=0;dashed=1;curved=1;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-81" target="WC-gbT3LFDN5c_wE5Nhx-67">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-81" value="副本0-1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="-266.5" y="560" width="124" height="30" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-83" value="副本0-2" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="105" y="560" width="124" height="30" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-99" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;dashed=1;curved=1;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-84" target="WC-gbT3LFDN5c_wE5Nhx-66">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-84" value="副本0-0" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="452" y="560" width="124" height="30" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-93" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;curved=1;dashed=1;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-87" target="WC-gbT3LFDN5c_wE5Nhx-68">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="-203" y="460" />
              <mxPoint x="526" y="460" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-87" value="副本1-2" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="-265" y="510" width="124" height="30" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-91" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;curved=1;dashed=1;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-88" target="WC-gbT3LFDN5c_wE5Nhx-66">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-88" value="副本1-0" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="105" y="510" width="124" height="30" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-90" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=1;entryDx=0;entryDy=0;curved=1;dashed=1;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-89" target="WC-gbT3LFDN5c_wE5Nhx-67">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-89" value="副本1-1" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="452" y="510" width="124" height="30" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-98" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.315;entryY=0.967;entryDx=0;entryDy=0;entryPerimeter=0;dashed=1;curved=1;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-83" target="WC-gbT3LFDN5c_wE5Nhx-68">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-102" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" edge="1" parent="1" source="WC-gbT3LFDN5c_wE5Nhx-100" target="WC-gbT3LFDN5c_wE5Nhx-101">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-100" value="注意：当前架构是3分片2副本，分片是开始时指定的，指定后不可更改，副本可以拓展缩容" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="-340" y="1000" width="590" height="40" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-101" value="" style="rounded=0;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="300" y="848" width="200" height="200" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-103" value="&lt;b&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;分片不可更改原因&lt;/font&gt;&lt;/b&gt;" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="310" y="858" width="120" height="30" as="geometry" />
        </mxCell>
        <mxCell id="WC-gbT3LFDN5c_wE5Nhx-104" value="如果开始设置3分片，有一条数据算出存在的切片位置是0，如果进行更变切片数量则之前计算的数据会有误差例如&lt;div&gt;hash(_Id) = 9 % 3 = 0&lt;/div&gt;&lt;div&gt;&lt;div&gt;hash(_Id) = 9 % 4 = 1&lt;/div&gt;&lt;div&gt;更变切片后他的切片id也会变，寻找数据的时候会出问题。&lt;/div&gt;&lt;div&gt;&lt;br&gt;&lt;/div&gt;&lt;/div&gt;" style="text;html=1;whiteSpace=wrap;overflow=hidden;rounded=0;" vertex="1" parent="1">
          <mxGeometry x="320" y="890" width="160" height="140" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
